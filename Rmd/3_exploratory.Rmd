## Exploratory data analysis

```{r indicators}
lapply(config$sources,
			 function(source) {
			 	lapply(source$indicator,
			 				 function(indicator) {c("Dataset" = source$description, "Indicator" = indicator)}
			 	) %>% 
			 		dplyr::bind_rows()
			 }) %>% 
	dplyr::bind_rows() %>% 
	knitr::kable(caption = "List of indicators collected",
							 escape = TRUE) %>% 
	kableExtra::collapse_rows(valign = "top") %>% 
	kableExtra::kable_styling()
```

The indicators collected are listed in Table \@ref(tab:indicators).

### Outcome data

```{r}
death_rate <- outcome %>% 
	dplyr::filter(variable == "death_rate") %>% 
	tidyr::pivot_wider(id_cols = fips,
										 names_from = variable,
										 values_from = estimate)
```

```{r mort-hist, fig.cap="Distribution of infant mortality rate"}
ggplot(death_rate, aes(x = death_rate)) +
	geom_histogram(bins = 10, fill = "#00416A", alpha = 0.9) +
	theme_minimal() +
	labs(x = "Death rate per 100,000 births",
			 y = "Number of counties",
			 title = "Distribution of infant mortality rate")
```

In Figure \@ref(fig:mort-hist), we can see the generally normal distribution of the mortality data. Furthermore, we can see that some counties have an infant mortality rate of almost `r scales::percent(max(death_rate$death_rate)/config$rate)`, which feels absurdly high.

```{r map, fig.cap="Map of infant mortality rate by county"}
geo_county <- urbnmapr::get_urbn_map("counties", sf = TRUE)

geo_county %>% 
	dplyr::left_join(death_rate, by = c("county_fips" = "fips")) %>% 
	ggplot(aes(fill = death_rate)) +
	geom_sf(color = "#ffffff", size = 0.05) +
	theme_minimal() +
	theme(axis.text = element_blank(),
				panel.grid = element_blank()) +
	scale_fill_gradient(low = "#9CECFB", high = "#00416A", na.value = "#dbdbdb") +
	labs(title = "Counties included in sample",
			 fill = "Death rate")
```

Figure \@ref(fig:map) shows the counties included in the study, filled by their infant mortality rate. Because the CDC suppresses data from counties with too few infant deaths, the sample counties mostly high-population counties. The missing counties almost certinaly influence the results, as many are rural, overwhelmingly White counties.

### Demographic data

```{r corrplot, fig.cap="Correlation plot for indicators under consideration"}
demographics %>%
	dplyr::select(fips, variable_name_short, estimate) %>%
	tidyr::pivot_wider(names_from = "variable_name_short", values_from = "estimate") %>%
	dplyr::select(-fips) %>%
	cor(.) %>%
	ggcorrplot::ggcorrplot(type = "full") +
	theme(axis.text.x = element_text(angle = 90, vjust = 0.5))
```

In Figure \@ref(fig:corrplot) we can see the correlations between our different demographic indicators. There are some obvious correlations due to singularities, such as between male and female. There are important correlations to consider across types of indicators, such as insurance and income, race, and education; education and income and race; and food stamps and income. We can use interaction terms in the regression to account for this.

The graph below (Figure \@ref(fig:food-stamps-income)) shows the strong negative correlation between food stamps and income as an example of such an interaction.

```{r food-stamps-income, fig.cap="There is a strong negative correlation between food stamps and income"}
demographics %>%
	dplyr::select(fips, variable_name_short, estimate) %>%
	dplyr::filter(variable_name_short %in% c("food_stamp", "income")) %>%
	tidyr::pivot_wider(id_cols = fips,
										 names_from = "variable_name_short",
										 values_from = "estimate") %>%
	ggplot(aes(x = food_stamp, y = income)) +
	geom_point() +
	theme_minimal() +
	labs(x = "Rate of residents on food stamps",
			 y = "Median income",
			 title = "Correlation between income and food stamps") +
	scale_x_continuous(labels = scales::comma) +
	scale_y_continuous(labels = scales::comma)
```

Before regression, all relevant demographic variables were transformed into rates using the county's population.

